# nginx.conf Documentation for MERN Stack Client Proxy

This document explains the structure and purpose of each section in the provided `nginx.conf` file, which is designed to serve a React frontend, proxy API requests to a Node.js/Express backend, and support real-time communication through Socket.io.

---

## Structure Overview

- **events block**: Configures NGINX worker connection limits.
- **http block**: Main configuration for serving content, logging, compression, and proxying.
- **server block**: Handles incoming HTTP requests on port 3000.

---

## Config Sections

### 1. `events { ... }`

- `worker_connections 1024;`
  - Sets the maximum number of simultaneous connections each NGINX worker process can handle.
  - Useful for high concurrency in development and production.

---

### 2. `http { ... }`

#### **MIME Types & Default Type**

- `include /etc/nginx/mime.types;`
  - Loads file type mappings, ensuring correct Content-Type headers.
- `default_type application/octet-stream;`
  - Default content type for files not matched in `mime.types`.

#### **Logging**

- `access_log /var/log/nginx/access_log;`
  - Records all incoming requests for monitoring and debugging.
- `error_log /var/log/nginx/error_log;`
  - Logs server errors and issues.

#### **Gzip Compression**

- `gzip on;`
  - Enables gzip compression to improve client load times.
- `gzip_vary on;`
  - Sets the `Vary: Accept-Encoding` header for proxy caches.
- `gzip_types ...`
  - Specifies which MIME types are compressed.

---

### 3. `server { ... }`

#### **Server Basics**

- `listen 3000;`
  - NGINX listens on port 3000 for incoming HTTP requests.
- `server_name localhost;`
  - Responds to requests targeting `localhost`.

---

#### **Location Blocks**

##### `/` – Serve React App

```nginx
location / {
    root /usr/share/nginx/html;
    index index.html index.htm;
    try_files $uri $uri/ /index.html;
}
```
- **Purpose**: Serves static files generated by React build.
- **SPA Support**: `try_files $uri $uri/ /index.html;` ensures client routes (e.g., `/about`, `/dashboard`) are handled by React.

---

##### `/api/` – Proxy API Requests

```nginx
location /api/ {
    proxy_pass http://localhost:5000/api/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```
- **Purpose**: Forwards requests to `/api/*` to an Express backend running on `localhost:5000`.
- **Headers**: Passes client information and protocol to the backend for accurate logging and request handling.

---

##### `/socket.io/` – WebSocket Proxy

```nginx
location /socket.io/ {
    proxy_pass http://localhost:5000/socket.io/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```
- **Purpose**: Proxies WebSocket connections for real-time communication with Socket.io.
- **WebSocket Support**: Upgrades the connection protocol and sets required headers.

---

## Usage Notes

- **React Build**: Place your built React files in `/usr/share/nginx/html`.
- **Backend**: Ensure your Express server runs on port 5000 and responds to `/api/` and `/socket.io/`.
- **Development**: Use `localhost` in proxy settings; for Docker, update to use container names (e.g., `exampro_server`).
- **Production**: Consider using HTTPS, increasing security headers, and fine-tuning worker and compression settings.

---

## Summary Table

| Location      | Purpose                         |
|---------------|---------------------------------|
| `/`           | Serves React static files & SPA |
| `/api/`       | Proxies REST API to backend     |
| `/socket.io/` | Proxies WebSocket traffic       |

---

## Further Customization

- **SSL/HTTPS**: Add SSL configuration for secure deployments.
- **Multiple APIs**: Add more `location` blocks for other backend endpoints.
- **Rate Limiting, CORS, Security**: Extend config for additional production requirements.
